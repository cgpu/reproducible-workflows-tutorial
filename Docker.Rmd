---
title: "Session 2: Docker"
output: 
  html_document:
    toc: true
    toc_float: true  
    code_folding: show
    code_download: false
    theme: cerulean  
    highlight: kate         
---



![](images/docker_wig_tail.gif)

<br> 

What is Docker? Why use it? [See about Docker slides]()

**Main outcome:** *During this session, you will learn how to build & run your own Docker container to bundle dependencies for FastQC & MultiQC*
<br> 

# a) Running images

Running a container is as easy as using the following command: 

```bash
docker run <container-name> 
```

For example: 

```bash
docker run hello-world  
```

## Run a container in interactive mode 

Launching a BASH shell in the container allows you to operate in an interactive mode 
in the containerised operating system. For example: 

```bash
docker run -it flowcraft/fastqc:0.11.7-1 bash 
``` 

Once the container is launched you will notice that's running as root (!). 
Use the usual commands to navigate in the file system.

To exit from the container, stop the BASH session with the `exit` command.

# b) Dockerfiles

Docker images are created by using a so called `Dockerfile` i.e. a simple text file 
containing a list of commands to be executed to assemble and configure the image
with the software packages required.    

In this step, you will create a Docker image containing the FastQC & MultiQC tools.


Warning: the Docker build process automatically copies all files that are located in the 
current directory to the Docker daemon in order to create the image. This can take 
a lot of time when big/many files exist. For this reason, it's important to *always* work in 
a directory containing only the files you really need to include in your Docker image. 
Alternatively, you can use the `.dockerignore` file to select the path to exclude from the build. 

Then use your favourite editor eg. `vim` to create a file named `Dockerfile` and copy the 
following content: 

```Dockerfile

FROM nfcore/base

LABEL authors="phil@lifebit.ai" \
      description="Docker image containing fastqc & multiqc for LBF hackathon tutorial"

RUN conda install -c bioconda fastqc=0.11.8 && \
    conda install -c bioconda multiqc=1.7
```

When done save the file. 

# c) Building images

Build the Docker image by using the following command: 

```bash
docker build -t my-image .
```

Note: don't miss the dot in the above command. When it completes, verify that the image 
has been created listing all available images: 

```bash
docker images
```

## For example:
With the `Dockerfile` from above you might want to run:
```bash
docker build -t lifebitai/lbf-hack .
```

![conda](https://raw.githubusercontent.com/PhilPalmer/lbf-hack-tutorial/master/images/conda.png)

And then you can enter inside the container to check everything is working:
```bash
docker run -it lifebitai/lbf-hack:latest bash
```

The container can be used in our Nextflow pipeline replacing the two different containers we currently have because it has both `fastqc` & `multiqc` installed


# d) BONUS: Upload the container to Docker Hub

Publish your container in Docker Hub to share it with other people. 

Create an account in the https://hub.docker.com web site. Then from your shell terminal run 
the following command, entering the user name and password you specified registering in the Hub: 

```bash
docker login 
``` 

Tag the image with your Docker user name account: 

```bash
docker tag my-image <user-name>/my-image 
```

Finally, push it to the Docker Hub:

```bash
docker push <user-name>/my-image 
```

After that anyone will be able to download it by using the command: 

```bash
docker pull <user-name>/my-image 
```

Note how after a pull and push operation, Docker prints the container digest number e.g. 

```
Digest: sha256:aeacbd7ea1154f263cda972a96920fb228b2033544c2641476350b9317dab266
Status: Downloaded newer image for nextflow/rnaseq-nf:latest
```

This is a unique and immutable identifier that can be used to reference container image 
in a univocally manner. For example: 

```bash
docker pull nextflow/rnaseq-nf@sha256:aeacbd7ea1154f263cda972a96920fb228b2033544c2641476350b9317dab266
```

<br />

# Next up: [Session 3: Flowcraft](Flowcraft.html)
